<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Guess The Anime - Essais progressifs</title>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }

    button, input {
      padding: 10px;
      margin: 5px;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
    }

    input {
      background-color: #1e1e1e;
      color: white;
      width: 300px;
      border: 1px solid #444;
    }

    button {
      background-color: #333;
      color: white;
      cursor: pointer;
    }

    button:disabled {
      background-color: #222;
      cursor: not-allowed;
      opacity: 0.6;
    }

    button:hover:not(:disabled) {
      background-color: #555;
    }

    .correct { color: #4caf50; }
    .incorrect { color: #f44336; }
    .hidden { display: none; }

    #autocomplete-list {
      position: absolute;
      background-color: #1e1e1e;
      border: 1px solid #444;
      z-index: 99;
      width: 300px;
      left: 50%;
      transform: translateX(-50%);
      max-height: 150px;
      overflow-y: auto;
    }

    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
    }

    .autocomplete-items div:hover {
      background-color: #333;
    }

    #playerWrapper {
      display: none;
    }
  </style>
</head>
<body>
  <h1>üéß Devine l'Opening (essais progressifs)</h1>

  <div id="playerWrapper">
    <div id="player"></div>
  </div>

  <div>
    <button id="playTry1">‚ñ∂Ô∏è √âcoute 1 (3s)</button>
    <button id="playTry2" disabled>‚ñ∂Ô∏è √âcoute 2 (5s)</button>
    <button id="playTry3" disabled>‚ñ∂Ô∏è √âcoute 3 (10s)</button>
    <button id="stopAudio">‚èπÔ∏è Stop</button>
  </div>

  <div>
    <input type="text" id="guessInput" placeholder="Entre le nom de l'anime" autocomplete="off">
    <div id="autocomplete-list" class="autocomplete-items"></div>
    <button onclick="checkAnswer()">Valider</button>
  </div>

  <p id="result"></p>
  <button id="shareButton" class="hidden">Partager sur Twitter/X</button>

  <script>
    const animeList = [
      {
        title: "Black Clover",
        altTitles: ["„Éñ„É©„ÉÉ„ÇØ„ÇØ„É≠„Éº„Éê„Éº", "Black Clover"],
        opening: "Black Rover",
        videoId: "4QDEWNg5hAM",
        startTime: 0
      }
      // Tu peux ajouter d'autres animes ici
    ];

    let player;
    let stopTimeout;
    let currentAnime = getDailyAnime();
    let triesPlayed = {1: false, 2: false, 3: false};
    let currentTry = 1;

    function getDailyAnime() {
      const today = new Date().toISOString().split('T')[0];
      const index = Math.floor(today.replace(/-/g, '') % animeList.length);
      return animeList[index];
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player("player", {
        height: "1",
        width: "1",
        videoId: currentAnime.videoId,
        playerVars: {
          autoplay: 0,
          controls: 0,
          modestbranding: 1,
          start: currentAnime.startTime
        },
        events: {
          onReady: () => {
            document.getElementById("playTry1").disabled = false;
          },
          onError: () => {
            document.getElementById("result").textContent = "Erreur : Impossible de charger l‚Äôaudio.";
            document.getElementById("result").classList.add("incorrect");
          }
        }
      });
    }

    function playTry(tryNumber, duration) {
      if (triesPlayed[tryNumber]) return;

      currentTry = tryNumber;
      triesPlayed[tryNumber] = true;

      if (player) {
        clearTimeout(stopTimeout);
        player.seekTo(currentAnime.startTime);
        player.playVideo();
        stopTimeout = setTimeout(() => {
          player.pauseVideo();
        }, duration * 1000);
      }

      // D√©bloquer le suivant apr√®s lecture
      if (tryNumber === 1) document.getElementById("playTry2").disabled = false;
      if (tryNumber === 2) document.getElementById("playTry3").disabled = false;

      document.getElementById(`playTry${tryNumber}`).disabled = true;
    }

    document.getElementById("playTry1").addEventListener("click", () => playTry(1, 3));
    document.getElementById("playTry2").addEventListener("click", () => playTry(2, 5));
    document.getElementById("playTry3").addEventListener("click", () => playTry(3, 10));

    document.getElementById("stopAudio").addEventListener("click", () => {
      if (player) {
        player.pauseVideo();
        clearTimeout(stopTimeout);
      }
    });

    function checkAnswer() {
      const input = document.getElementById("guessInput").value.trim().toLowerCase();
      const result = document.getElementById("result");
      const shareButton = document.getElementById("shareButton");
      const isCorrect = currentAnime.altTitles.some(ans => ans.toLowerCase() === input);

      if (isCorrect) {
        result.textContent = `‚úÖ Bravo ! C‚Äô√©tait ${currentAnime.title} - ${currentAnime.opening}`;
        result.className = "correct";
        shareButton.classList.remove("hidden");
      } else {
        if (currentTry === 3 || (triesPlayed[1] && triesPlayed[2] && triesPlayed[3])) {
          result.textContent = `‚ùå Mauvaise r√©ponse. C‚Äô√©tait ${currentAnime.title} - ${currentAnime.opening}`;
          shareButton.classList.remove("hidden");
        } else {
          result.textContent = `‚ùå Faux. Essaie une autre √©coute.`;
        }
        result.className = "incorrect";
      }
    }

    document.getElementById("shareButton").addEventListener("click", () => {
      const result = document.getElementById("result").textContent;
      const text = `J‚Äôai jou√© √† Guess The Anime Opening ! ${result} üé∂ Essayez ici : [URL de votre site]`;
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, "_blank");
    });

    document.getElementById("guessInput").addEventListener("input", function () {
      const input = this.value.toLowerCase();
      const list = document.getElementById("autocomplete-list");
      list.innerHTML = "";

      if (!input) return;

      const suggestions = animeList.filter(anime =>
        anime.title.toLowerCase().includes(input) ||
        anime.altTitles.some(alt => alt.toLowerCase().includes(input)) ||
        anime.opening.toLowerCase().includes(input)
      );

      suggestions.forEach(anime => {
        const div = document.createElement("div");
        div.textContent = `${anime.title} - ${anime.opening}`;
        div.addEventListener("click", () => {
          document.getElementById("guessInput").value = anime.title;
          list.innerHTML = "";
          checkAnswer();
        });
        list.appendChild(div);
      });
    });

    document.addEventListener("click", e => {
      if (!e.target.closest("#guessInput") && !e.target.closest(".autocomplete-items")) {
        document.getElementById("autocomplete-list").innerHTML = "";
      }
    });

    document.getElementById("guessInput").addEventListener("keydown", e => {
      if (e.key === "Enter") checkAnswer();
    });

    const tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
  </script>
</body>
</html>
