<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Guess The Anime Opening</title>
  <style>
    .hidden-video {
      width: 1px;
      height: 1px;
      opacity: 0;
      pointer-events: none;
      position: absolute;
      left: -9999px;
    }
    .correct { color: green; }
    .incorrect { color: red; }
    .autocomplete-items div {
      background-color: #f1f1f1;
      padding: 5px;
      cursor: pointer;
    }
    .autocomplete-items div:hover {
      background-color: #e0e0e0;
    }
  </style>
</head>
<body>
  <h1>üé∂ Devine l'opening d'anime !</h1>

  <div id="playerWrapper">
    <div id="player"></div>
  </div>

  <button id="playAudio">‚ñ∂Ô∏è √âcouter</button>
  <button id="stopAudio">‚èπÔ∏è Stop</button>
  <button id="toggleVideo">üì∫ Cacher la vid√©o</button>

  <div>
    <input type="text" id="guessInput" placeholder="Entre le nom de l'anime" autocomplete="off">
    <div id="autocomplete-list" class="autocomplete-items"></div>
    <button onclick="checkAnswer()">Valider</button>
  </div>

  <p id="result"></p>
  <button id="shareButton" class="hidden">Partager sur Twitter/X</button>

  <script>
    const animeList = [
      {
        title: "Black Clover",
        altTitles: ["„Éñ„É©„ÉÉ„ÇØ„ÇØ„É≠„Éº„Éê„Éº", "Black Clover"],
        opening: "Black Rover",
        videoId: "4QDEWNg5hAM",
        startTime: 0,
        endTime: 15
      },
      // Ajoutez d'autres animes ici
    ];

    function getDailyAnime() {
      const today = new Date().toISOString().split('T')[0];
      const index = Math.floor(today.replace(/-/g, '') % animeList.length);
      return animeList[index];
    }

    let player;
    let stopTimeout;
    let videoVisible = false;
    let currentAnime = getDailyAnime();

    function onYouTubeIframeAPIReady() {
      player = new YT.Player("player", {
        height: "270",
        width: "480",
        videoId: currentAnime.videoId,
        playerVars: {
          autoplay: 1,
          mute: 1,
          controls: 0,
          modestbranding: 1,
          start: currentAnime.startTime,
          end: currentAnime.endTime
        },
        events: {
          onReady: () => {
            player.unMute(); // Facultatif
            document.getElementById("playAudio").disabled = false;
            document.getElementById("stopAudio").disabled = false;
          },
          onStateChange: onPlayerStateChange,
          onError: (event) => {
            document.getElementById("result").textContent = "Erreur : Impossible de charger la vid√©o.";
            document.getElementById("result").classList.add("incorrect");
          }
        }
      });
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        clearTimeout(stopTimeout);
        const duration = (currentAnime.endTime - currentAnime.startTime) * 1000;
        stopTimeout = setTimeout(() => {
          player.pauseVideo();
        }, duration);
      }
    }

    document.getElementById("playAudio").addEventListener("click", () => {
      if (player) {
        player.seekTo(currentAnime.startTime);
        player.playVideo();
      }
    });

    document.getElementById("stopAudio").addEventListener("click", () => {
      if (player) {
        player.pauseVideo();
        clearTimeout(stopTimeout);
      }
    });

    document.getElementById("toggleVideo").addEventListener("click", () => {
      const wrapper = document.getElementById("playerWrapper");
      videoVisible = !videoVisible;
      wrapper.classList.toggle("hidden-video", !videoVisible);
      document.getElementById("toggleVideo").textContent = videoVisible ? "üì∫ Cacher la vid√©o" : "üì∫ Afficher la vid√©o";
    });

    function checkAnswer() {
      const input = document.getElementById("guessInput").value.trim().toLowerCase();
      const isCorrect = currentAnime.altTitles.some(ans => ans.toLowerCase() === input);
      const result = document.getElementById("result");
      const shareButton = document.getElementById("shareButton");

      result.textContent = isCorrect
        ? `‚úÖ Bravo ! C‚Äôest ${currentAnime.title} - ${currentAnime.opening}`
        : `‚ùå Faux. C‚Äô√©tait ${currentAnime.title} - ${currentAnime.opening}`;
      result.classList.remove("correct", "incorrect");
      result.classList.add(isCorrect ? "correct" : "incorrect");

      shareButton.classList.remove("hidden");
    }

    document.getElementById("shareButton").addEventListener("click", () => {
      const result = document.getElementById("result").textContent;
      const text = `J‚Äôai jou√© √† Guess The Anime Opening ! ${result} üé∂ Essayez ici : [URL de votre site]`;
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, "_blank");
    });

    document.getElementById("guessInput").addEventListener("input", function () {
      const input = this.value.toLowerCase();
      const autocompleteList = document.getElementById("autocomplete-list");
      autocompleteList.innerHTML = "";

      if (!input) return;

      const suggestions = animeList.filter(
        anime =>
          anime.title.toLowerCase().includes(input) ||
          anime.altTitles.some(alt => alt.toLowerCase().includes(input)) ||
          anime.opening.toLowerCase().includes(input)
      );

      suggestions.forEach(anime => {
        const div = document.createElement("div");
        div.textContent = `${anime.title} - ${anime.opening}`;
        div.addEventListener("click", () => {
          document.getElementById("guessInput").value = anime.title;
          autocompleteList.innerHTML = "";
          checkAnswer();
        });
        autocompleteList.appendChild(div);
      });
    });

    document.addEventListener("click", e => {
      if (!e.target.closest("#guessInput") && !e.target.closest(".autocomplete-items")) {
        document.getElementById("autocomplete-list").innerHTML = "";
      }
    });

    document.getElementById("guessInput").addEventListener("keydown", e => {
      if (e.key === "Enter") {
        checkAnswer();
      }
    });

    // Charger l'API YouTube
    const tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
  </script>
</body>
</html>
