// Variables globales
let currentQuestion = 0;
let score = 0;
let questions = [];

// Charger les questions depuis questions.json
async function loadQuestions() {
    try {
        const response = await fetch('assets/questions.json');
        questions = await response.json();
        loadQuestion();
    } catch (error) {
        console.error('Erreur lors du chargement des questions:', error);
        document.getElementById('question-container').innerHTML = '<p>Erreur lors du chargement des questions.</p>';
    }
}

// Charger une question
function loadQuestion() {
    if (currentQuestion >= questions.length) {
        endQuiz();
        return;
    }

    const q = questions[currentQuestion];
    document.getElementById('question-img').src = q.image || 'assets/images/worlds-logo.png';
    document.getElementById('question-text').textContent = q.question;
    document.getElementById('feedback').textContent = '';

    const optionsDiv = document.getElementById('options');
    const answerInput = document.getElementById('answer');
    optionsDiv.innerHTML = '';

    if (q.type === 'multiple') {
        answerInput.style.display = 'none';
        optionsDiv.style.display = 'flex';
        q.options.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option';
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(opt);
            optionsDiv.appendChild(btn);
        });
    } else {
        answerInput.style.display = 'block';
        optionsDiv.style.display = 'none';
        answerInput.value = '';
    }
}

// Vérifier la réponse
function checkAnswer(userAnswer) {
    const q = questions[currentQuestion];
    const feedback = document.getElementById('feedback');
    userAnswer = userAnswer || document.getElementById('answer').value.trim();

    if (userAnswer.toLowerCase() === q.answer.toLowerCase()) {
        feedback.textContent = 'Correct !';
        feedback.style.color = '#28a745';
        score += 10;
        document.getElementById('score').textContent = score;
    } else {
        feedback.textContent = `Faux ! La réponse était ${q.answer}.`;
        feedback.style.color = '#dc3545';
    }

    currentQuestion++;
    setTimeout(loadQuestion, 1000); // Attendre 1 seconde avant la prochaine question
}

// Terminer le quiz
function endQuiz() {
    document.getElementById('question-container').innerHTML = `
        <h2>Quiz terminé !</h2>
        <p>Score final : ${score}</p>
        <a href="quiz.html" class="btn">Rejouer</a>
        <a href="index.html" class="btn">Retour à l'accueil</a>
    `;
    // Sauvegarder le score dans localStorage
    const highScore = localStorage.getItem('highScore') || 0;
    if (score > highScore) {
        localStorage.setItem('highScore', score);
    }
}

// Lancer le chargement des questions
loadQuestions();
