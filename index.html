<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>üé∂ Guess The Anime Opening</title>
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
    }

    input, button {
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
    }

    input {
      width: 300px;
      background-color: #1e1e1e;
      color: white;
      border: 1px solid #444;
    }

    button {
      background-color: #333;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #555;
    }

    #autocomplete-list {
      position: absolute;
      background-color: #1e1e1e;
      border: 1px solid #444;
      z-index: 99;
      width: 300px;
      left: 50%;
      transform: translateX(-50%);
      max-height: 150px;
      overflow-y: auto;
    }

    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }

    .autocomplete-items div:hover {
      background-color: #333;
    }

    .correct { color: #4caf50; }
    .incorrect { color: #f44336; }

    .hidden {
      display: none;
    }

    #playerWrapper {
      display: none; /* Vid√©o masqu√©e par d√©faut */
    }
  </style>
</head>
<body>
  <h1>üéß Devine l'opening d'anime</h1>

  <div id="playerWrapper">
    <div id="player"></div>
  </div>

  <div>
    <button id="playAudio">‚ñ∂Ô∏è √âcouter</button>
    <button id="stopAudio">‚èπÔ∏è Stop</button>
  </div>

  <div>
    <input type="text" id="guessInput" placeholder="Entre le nom de l'anime" autocomplete="off">
    <div id="autocomplete-list" class="autocomplete-items"></div>
    <button onclick="checkAnswer()">Valider</button>
  </div>

  <p id="result"></p>
  <button id="shareButton" class="hidden">Partager sur Twitter/X</button>

  <script>
    const animeList = [
      {
        title: "Black Clover",
        altTitles: ["„Éñ„É©„ÉÉ„ÇØ„ÇØ„É≠„Éº„Éê„Éº", "Black Clover"],
        opening: "Black Rover",
        videoId: "4QDEWNg5hAM",
        startTime: 0,
        endTime: 15
      },
      // Ajoute d'autres animes ici
    ];

    function getDailyAnime() {
      const today = new Date().toISOString().split('T')[0];
      const index = Math.floor(today.replace(/-/g, '') % animeList.length);
      return animeList[index];
    }

    let player;
    let stopTimeout;
    const currentAnime = getDailyAnime();

    function onYouTubeIframeAPIReady() {
      player = new YT.Player("player", {
        height: "1",
        width: "1",
        videoId: currentAnime.videoId,
        playerVars: {
          autoplay: 1,
          mute: 1,
          controls: 0,
          modestbranding: 1,
          start: currentAnime.startTime,
          end: currentAnime.endTime
        },
        events: {
          onReady: () => {
            player.unMute();
            document.getElementById("playAudio").disabled = false;
            document.getElementById("stopAudio").disabled = false;
          },
          onStateChange: onPlayerStateChange,
          onError: () => {
            document.getElementById("result").textContent = "Erreur : Impossible de charger l‚Äôaudio.";
            document.getElementById("result").classList.add("incorrect");
          }
        }
      });
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        clearTimeout(stopTimeout);
        const duration = (currentAnime.endTime - currentAnime.startTime) * 1000;
        stopTimeout = setTimeout(() => player.pauseVideo(), duration);
      }
    }

    document.getElementById("playAudio").addEventListener("click", () => {
      if (player) {
        player.seekTo(currentAnime.startTime);
        player.playVideo();
      }
    });

    document.getElementById("stopAudio").addEventListener("click", () => {
      if (player) {
        player.pauseVideo();
        clearTimeout(stopTimeout);
      }
    });

    function checkAnswer() {
      const input = document.getElementById("guessInput").value.trim().toLowerCase();
      const isCorrect = currentAnime.altTitles.some(ans => ans.toLowerCase() === input);
      const result = document.getElementById("result");
      const shareButton = document.getElementById("shareButton");

      result.textContent = isCorrect
        ? `‚úÖ Bravo ! C‚Äôest ${currentAnime.title} - ${currentAnime.opening}`
        : `‚ùå Faux. C‚Äô√©tait ${currentAnime.title} - ${currentAnime.opening}`;
      result.classList.remove("correct", "incorrect");
      result.classList.add(isCorrect ? "correct" : "incorrect");

      shareButton.classList.remove("hidden");
    }

    document.getElementById("shareButton").addEventListener("click", () => {
      const result = document.getElementById("result").textContent;
      const text = `J‚Äôai jou√© √† Guess The Anime Opening ! ${result} üé∂ Essayez ici : [URL de votre site]`;
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, "_blank");
    });

    document.getElementById("guessInput").addEventListener("input", function () {
      const input = this.value.toLowerCase();
      const autocompleteList = document.getElementById("autocomplete-list");
      autocompleteList.innerHTML = "";

      if (!input) return;

      const suggestions = animeList.filter(
        anime =>
          anime.title.toLowerCase().includes(input) ||
          anime.altTitles.some(alt => alt.toLowerCase().includes(input)) ||
          anime.opening.toLowerCase().includes(input)
      );

      suggestions.forEach(anime => {
        const div = document.createElement("div");
        div.textContent = `${anime.title} - ${anime.opening}`;
        div.addEventListener("click", () => {
          document.getElementById("guessInput").value = anime.title;
          autocompleteList.innerHTML = "";
          checkAnswer();
        });
        autocompleteList.appendChild(div);
      });
    });

    document.addEventListener("click", e => {
      if (!e.target.closest("#guessInput") && !e.target.closest(".autocomplete-items")) {
        document.getElementById("autocomplete-list").innerHTML = "";
      }
    });

    document.getElementById("guessInput").addEventListener("keydown", e => {
      if (e.key === "Enter") {
        checkAnswer();
      }
    });

    // Charger l'API YouTube
    const tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
  </script>
</body>
</html>

